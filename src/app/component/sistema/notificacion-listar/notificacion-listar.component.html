<div class="container" style="padding: 20px;">
  
  <div style="margin-bottom: 20px;">
    <h2>Mis Notificaciones</h2>
    </div>

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

    <ng-container matColumnDef="titulo">
      <th mat-header-cell *matHeaderCellDef> Asunto </th>
      <td mat-cell *matCellDef="let n"> 
        <div style="display: flex; align-items: center;">
          <mat-icon style="margin-right: 8px; color: gray; font-size: 20px;">
            {{ n.leido ? 'drafts' : 'mail' }}
          </mat-icon>
          <span [style.fontWeight]="n.leido ? 'normal' : 'bold'">
            {{ n.titulo }}
          </span>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="mensaje">
      <th mat-header-cell *matHeaderCellDef> Mensaje </th>
      <td mat-cell *matCellDef="let n" style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"> 
        {{ n.mensaje }} 
      </td>
    </ng-container>

    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef> Recibido </th>
      <td mat-cell *matCellDef="let n" style="color: gray; font-size: 0.9em;"> 
        {{ n.fechaEnvio | date:'dd MMM yyyy, h:mm a' }} 
      </td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef> Estado </th>
      <td mat-cell *matCellDef="let n">
        <mat-chip [style.backgroundColor]="n.leido ? '#eee' : '#e3f2fd'" 
                  [style.color]="n.leido ? 'gray' : '#1565c0'">
          {{ n.leido ? 'Leído' : 'Nuevo' }}
        </mat-chip>
      </td>
    </ng-container>

    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef> Acciones </th>
      <td mat-cell *matCellDef="let n">
        
        <button mat-icon-button color="primary" *ngIf="!n.leido" (click)="marcarLeida(n)" matTooltip="Marcar como leído">
          <mat-icon>check_circle</mat-icon>
        </button>

        <button mat-icon-button color="warn" (click)="eliminar(n.notificacionId!)" matTooltip="Borrar">
          <mat-icon>delete_outline</mat-icon>
        </button>

      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
        [style.backgroundColor]="row.leido ? 'white' : '#f8fdff'"></tr>
  </table>
  
  <div *ngIf="dataSource.data.length === 0" style="padding: 40px; text-align: center; color: gray;">
    <mat-icon style="font-size: 48px; height: 48px; width: 48px; margin-bottom: 10px;">notifications_off</mat-icon>
    <p>No tienes notificaciones.</p>
  </div>
</div>