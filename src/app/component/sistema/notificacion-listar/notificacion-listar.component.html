<div class="notifications-container">

  <!-- Header -->
  <div class="notifications-header">
    <div class="header-left">
      <h1>
        <mat-icon class="header-icon">notifications</mat-icon>
        Notificaciones
      </h1>
      <p class="subtitle" *ngIf="!cargando">
        <span *ngIf="cantidadNoLeidas > 0" class="badge-count">{{ cantidadNoLeidas }}</span>
        {{ cantidadNoLeidas === 0 ? 'No tienes notificaciones nuevas' : cantidadNoLeidas === 1 ? '1 notificación nueva'
        : cantidadNoLeidas + ' notificaciones nuevas' }}
      </p>
    </div>

    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="marcarTodasLeidas()" [disabled]="cantidadNoLeidas === 0"
        matTooltip="Marcar todas como leídas">
        <mat-icon>done_all</mat-icon>
        Marcar todas como leídas
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-container" *ngIf="!cargando && notificaciones.length > 0">
    <button mat-button [class.active]="filtroActual === 'todas'" (click)="cambiarFiltro('todas')">
      <mat-icon>list</mat-icon>
      Todas ({{ notificaciones.length }})
    </button>

    <button mat-button [class.active]="filtroActual === 'noLeidas'" (click)="cambiarFiltro('noLeidas')">
      <mat-icon>mark_email_unread</mat-icon>
      No leídas ({{ cantidadNoLeidas }})
    </button>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="cargando">
    <mat-spinner></mat-spinner>
    <p>Cargando notificaciones...</p>
  </div>

  <!-- Lista de Notificaciones -->
  <div class="notifications-list" *ngIf="!cargando">

    <div class="notification-card" *ngFor="let notificacion of notificacionesFiltradas"
      [class.unread]="!notificacion.leido" (click)="marcarLeida(notificacion)">

      <!-- Indicador de no leída -->
      <div class="unread-indicator" *ngIf="!notificacion.leido"></div>

      <!-- Icono -->
      <div class="notification-icon-container">
        <div class="notification-icon" [style.background-color]="getColorNotificacion(notificacion.titulo)">
          <mat-icon>{{ getIconoNotificacion(notificacion.titulo) }}</mat-icon>
        </div>
      </div>

      <!-- Contenido -->
      <div class="notification-content">
        <div class="notification-header-row">
          <h3 class="notification-title">{{ notificacion.titulo }}</h3>
          <span class="notification-time">{{ formatearFecha(notificacion.fechaEnvio) }}</span>
        </div>

        <p class="notification-message">{{ notificacion.mensaje }}</p>

        <!-- Estado y Acciones -->
        <div class="notification-footer">
          <div class="notification-status">
            <mat-chip [class.chip-unread]="!notificacion.leido" [class.chip-read]="notificacion.leido">
              <mat-icon>{{ notificacion.leido ? 'done' : 'fiber_new' }}</mat-icon>
              {{ notificacion.leido ? 'Leída' : 'Nueva' }}
            </mat-chip>
          </div>

          <div class="notification-actions">
            <button mat-icon-button *ngIf="!notificacion.leido" (click)="marcarLeida(notificacion, $event)"
              matTooltip="Marcar como leída" class="action-btn">
              <mat-icon>check_circle</mat-icon>
            </button>

            <button mat-icon-button color="warn" (click)="eliminar(notificacion.notificacionId!, $event)"
              matTooltip="Eliminar" class="action-btn">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado Vacío -->
    <div class="empty-state" *ngIf="notificacionesFiltradas.length === 0 && notificaciones.length > 0">
      <mat-icon>inbox</mat-icon>
      <h3>No hay notificaciones {{ filtroActual === 'noLeidas' ? 'sin leer' : '' }}</h3>
      <p>{{ filtroActual === 'noLeidas' ? 'Todas tus notificaciones están leídas' : 'No tienes notificaciones en este
        momento' }}</p>
    </div>

    <div class="empty-state" *ngIf="notificaciones.length === 0">
      <mat-icon>notifications_off</mat-icon>
      <h3>No tienes notificaciones</h3>
      <p>Cuando recibas notificaciones aparecerán aquí</p>
    </div>

  </div>

</div>